pkgname=libpng
pkgver=1.6.53
pkgrel=2
url="http://www.libpng.org/pub/png/libpng.html"
source=("git+https://git.code.sf.net/p/libpng/code#tag=v$pkgver" "libpng.patch")
sha256sums=('SKIP' 'SKIP')
depends=('zlib')

prepare() {
  cd code
  patch -p1 < ../libpng.patch
}

build() {
  cd code
  mkdir build && cd build
  cmake .. -DCMAKE_TOOLCHAIN_FILE=$VITASDK/share/vita.toolchain.cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=$prefix -DPNG_ARM_NEON=on -DPNG_SHARED=OFF -DSKIP_INSTALL_EXECUTABLES=ON
  make -j$(nproc)
}

package () {
  cd code/build
  make DESTDIR=$pkgdir install
}
