pkgname=mbedtls
pkgver=3.6.5
pkgrel=1
url="https://www.trustedfirmware.org/projects/mbed-tls/"
source=("https://github.com/Mbed-TLS/mbedtls/releases/download/mbedtls-$pkgver/mbedtls-$pkgver.tar.bz2" "mbedtls.patch")
sha256sums=('4a11f1777bb95bf4ad96721cac945a26e04bf19f57d905f241fe77ebeddf46d8' 'SKIP')

prepare() {
  cd $pkgname-$pkgver
  patch --strip=1 --input=${srcdir}/mbedtls.patch
}

build() {
  cd $pkgname-$pkgver
  mkdir build && cd build
  cmake .. -DCMAKE_TOOLCHAIN_FILE=$VITASDK/share/vita.toolchain.cmake -DCMAKE_INSTALL_PREFIX=$prefix -DCMAKE_BUILD_TYPE=Release -DENABLE_PROGRAMS=OFF -DENABLE_TESTING=OFF -DMBEDTLS_FATAL_WARNINGS=OFF
  make -j$(nproc) mbedtls
}

package () {
  cd $pkgname-$pkgver/build
  make DESTDIR=$pkgdir install
}
